(this["webpackJsonpstorrsoft-maze"]=this["webpackJsonpstorrsoft-maze"]||[]).push([[0],[,,,function(e,t,n){e.exports={row:"Header_row__3nAfu",score:"Header_score__d2DrR"}},,,,,,,,,function(e,t,n){e.exports={root:"App_root__33b96"}},function(e,t,n){e.exports={root:"Notification_root__2LX0b"}},function(e,t,n){e.exports=n.p+"static/media/lollipop.5bf858ee.svg"},function(e,t,n){e.exports=n.p+"static/media/ice_cream.c760f5dc.svg"},function(e,t,n){e.exports={root:"Board_root__1mqwi"}},function(e,t,n){e.exports=n.p+"static/media/logo.f342226d.svg"},function(e,t,n){e.exports=n.p+"static/media/maze.12c141ff.mp3"},function(e,t,n){e.exports=n.p+"static/media/level_end.3931d957.mp3"},function(e,t,n){e.exports=n(26)},,,,,function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(11),o=n.n(i),s=(n(25),n(6)),c=n(2),l=n(1),u=n(12),d=n.n(u),h=n(8),m=n(3),f=n.n(m);var p=function(e){var t=e.hiScore,n=e.time,r=e.points,i=e.round;return a.a.createElement("header",null,a.a.createElement("div",{className:f.a.row},a.a.createElement("p",null,"Welcome to the StorrSoft maze!"),a.a.createElement("p",null,"Hi-Score ",a.a.createElement("span",{className:f.a.score},t.toString().padStart(5," ")))),a.a.createElement("p",null,"1UP ",a.a.createElement("span",{className:f.a.score},r.toString().padStart(5," ")),"\xa0\xa0 ROUND ",a.a.createElement("span",{className:f.a.score},i.toString().padStart(3," ")),"\xa0\xa0 TIME ",a.a.createElement("span",{className:f.a.score},n||0===n?n.toString().padStart(2," "):null)))},v=n(13),w=n.n(v);var b=function(e){var t=e.show,n=e.gameOver;return t&&a.a.createElement("div",{className:w.a.root},n?a.a.createElement("p",null,"GAME OVER"):null,"PRESS ",a.a.createElement("kbd",null,"Enter")," TO START")},g=n(9),y=n(5),O=function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0},j=n(14),C=n.n(j),k=n(15),z=n.n(k),E="Enter",S="ArrowLeft",x="ArrowRight",R="ArrowUp",G="ArrowDown",T=[{name:"Lollipop",image:C.a,points:2e3},{name:"IceCream",image:z.a,points:5e3}];function _(e,t){return Math.floor(Math.random()*(t-e)+e)}var A=function(){function e(t,n,r,a,i,o){Object(y.a)(this,e),this.rows=t,this.cols=n,this.cells=r,this.startCell=a,this.endCell=i;for(var s=new Set;s.size<o;){var l=this.getRandomCell();O(l,a)||O(l,i)||s.add(l.toString())}this.randomCells=Object(c.a)(s).map((function(e){return e.split(",").map((function(e){return parseInt(e,10)}))}))}return Object(g.a)(e,[{key:"getCell",value:function(e,t){return this.cells[e+t*this.cols]}},{key:"getRandomCell",value:function(){return[_(0,this.cols),_(0,this.rows)]}},{key:"validateStep",value:function(e,t){var n=Object(c.a)(e),r=this.getCell.apply(this,Object(c.a)(e));switch(t){case S:e[0]-1>=0&&!r[3]&&(n[0]=e[0]-1);break;case x:e[0]+1<this.cols&&!r[1]&&(n[0]=e[0]+1);break;case R:e[1]-1>=0&&!r[0]&&(n[1]=e[1]-1);break;case G:e[1]+1<this.rows&&!r[2]&&(n[1]=e[1]+1);break;default:throw new Error("Unknown key action")}return{isValid:!O(e,n),newPos:n}}},{key:"isGoalReached",value:function(e){return O(e,this.endCell)}},{key:"getPrizeCellIndex",value:function(e){return this.randomCells.findIndex((function(t){return O(t,e)}))}},{key:"isPrizeCell",value:function(e){return-1!==this.getPrizeCellIndex(e)}}]),e}(),P=function e(t,n){Object(y.a)(this,e),this.x=t,this.y=n,this.walls=[!0,!0,!0,!0],this.visited=!1},I=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;Object(y.a)(this,e),this.rows=t,this.cols=n,this.stack=[],this.pickRandomCellsAmount=r}return Object(g.a)(e,[{key:"createGrid",value:function(){for(var e=[],t=0;t<this.rows;t++)for(var n=0;n<this.cols;n++)e.push(new P(n,t));this.grid=e}},{key:"getCell",value:function(e,t){return t<0||e<0||t>=this.cols||e>=this.rows?null:this.grid[t+e*this.cols]}},{key:"checkNeighbors",value:function(){var e=this.current.x,t=this.current.y,n=[this.getCell(t-1,e),this.getCell(t,e+1),this.getCell(t+1,e),this.getCell(t,e-1)].filter((function(e){return!!e&&!e.visited}));return 0===n.length?null:n[Math.floor(Math.random()*n.length)]}},{key:"removeWallsBetweenCurrentAnd",value:function(e){var t=this.current.x-e.x,n=this.current.y-e.y;1===t?(this.current.walls[3]=!1,e.walls[1]=!1):-1===t&&(this.current.walls[1]=!1,e.walls[3]=!1),1===n?(this.current.walls[0]=!1,e.walls[2]=!1):-1===n&&(this.current.walls[2]=!1,e.walls[0]=!1)}},{key:"carve",value:function(){var e=this.checkNeighbors();e?(e.visited=!0,this.stack.push(this.current),this.removeWallsBetweenCurrentAnd(e),this.current=e,this.carve()):this.stack.length>0&&(this.current=this.stack.pop(),this.carve())}},{key:"generate",value:function(){return this.createGrid(),this.current=this.grid[0],this.current.visited=!0,this.carve(),this.grid[0].walls[3]=!1,this.getCell(this.rows-1,this.cols-1).walls[2]=!1,new A(this.rows,this.cols,this.grid.map((function(e){return e.walls})),[0,0],[this.cols-1,this.rows-1],this.pickRandomCellsAmount)}}]),e}(),M=n(16),N=n.n(M),L=n(17),B=n.n(L);var D=function(e){var t=e.maze,n=e.currentCell,i=e.prizes,o=Object(r.useRef)(null),c=Object(r.useRef)(null),l=Object(r.useState)(void 0),u=Object(s.a)(l,2),d=u[0],m=u[1],f=Object(r.useState)(!0),p=Object(s.a)(f,2),v=p[0],w=p[1],b=function(){setTimeout((function(){var e=c.current,t=e.offsetWidth,n=e.offsetHeight;o.current.width=t,o.current.height=n,o.current.style.width=t+"px",o.current.style.height=n+"px"}),0),m(o.current.getContext("2d"))};return Object(r.useEffect)((function(){return b(),window.addEventListener("resize",b),function(){return window.removeEventListener("resize",b)}}),[]),Object(r.useEffect)((function(){var e=!1,r=function(e,t,n,r){d.strokeStyle="white",d.beginPath(),d.moveTo(e,t),d.lineTo(e+n,t+r),d.stroke()};return function(){if(t){d.fillStyle="black",d.fillRect(0,0,o.current.width,o.current.height);for(var a=Math.floor(o.current.width/t.cols),s=Math.floor(o.current.height/t.rows),c=Math.floor((o.current.width-t.cols*a)/2),l=0;l<t.rows;l++)for(var u=0;u<t.cols;u++){var h=t.cells[u+l*t.cols];0===l&&h[0]&&r(a*u+c,s*l,a,0),h[1]&&r(a*(u+1)+c,s*l,0,s),h[2]&&r(a*u+c,s*(l+1),a,0),0===u&&h[3]&&r(a*u+c,s*l,0,s)}var m=function(t,n,r){var i=.75*Math.min(a,s),o=new Image(i,i);o.onload=function(){e||d.drawImage(o,t*a+c+(a-i)/2,n*s+(s-i)/2,i,i)},o.src=r},f=function(e,t,n,r){var i=Math.min(a,s);d.fillStyle=r,d.font='20px "Joystix"',d.textBaseline="top",d.fillText(n,e*a+c+(a-i)/2,t*s+(s-i)/2,i)};m(n[0],n[1],B.a),v&&f(t.endCell[0],t.endCell[1],"Goal","red"),i.forEach((function(e){var t=e.cell,n=e.image,r=e.isTaken,a=e.points,i=e.takenTime;r&&new Date-i<=3e3?f(t[0],t[1],"+".concat(a),"yellow"):r||m(t[0],t[1],n)}))}}(),function(){e=!0}}),[d,n,t,v,i]),Object(h.a)((function(){w((function(e){return!e}))}),1e3),a.a.createElement("div",{className:N.a.root,ref:c},a.a.createElement("canvas",{ref:o}))},W=function(){};function U(e,t){var n=Object(r.useRef)(W);n.current=t,Object(r.useEffect)((function(){var t=function(t){e.includes(t.key)&&(t.preventDefault(),n.current&&n.current(t))};return window.addEventListener("keydown",t),function(){return window.removeEventListener("keydown",t)}}),[e])}var H=n(18),J=n.n(H),V=n(19),q=n.n(V);function X(e,t){switch(t.type){case"startGame":return Object(l.a)(Object(l.a)({},e),{},{maze:t.payload.maze,currentCell:t.payload.maze.startCell,time:60,visitedCells:new Set,isGoalReached:!1,prizes:[]});case"reachGoal":return Object(l.a)(Object(l.a)({},e),{},{isGoalReached:!0,points:e.points+e.round*e.time*100});case"winGame":return Object(l.a)(Object(l.a)({},e),{},{maze:t.payload.maze,currentCell:t.payload.maze.startCell,time:60,round:e.round+1,visitedCells:new Set,isGoalReached:!1,prizes:[]});case"decrementTime":return Object(l.a)(Object(l.a)({},e),{},{time:e.time-1});case"endGame":return Object(l.a)(Object(l.a)({},e),{},{hiScore:Math.max(e.hiScore,e.points),points:0});case"addPrize":var n=t.payload.index,r=Object(l.a)(Object(l.a)({},T[n]),{},{isTaken:!1,cell:e.maze.randomCells[n]});return Object(l.a)(Object(l.a)({},e),{},{prizes:[].concat(Object(c.a)(e.prizes),[r])});case"reachPrize":var a=t.payload.removeIndex;return Object(l.a)(Object(l.a)({},e),{},{points:e.points+(e.prizes[a].isTaken?0:e.prizes[a].points),prizes:e.prizes.map((function(e,t){return t===a?Object(l.a)(Object(l.a)({},e),{},{isTaken:!0,takenTime:new Date}):e}))});case"moveCharacter":var i=e.visitedCells.has(t.payload.cells.toString());return Object(l.a)(Object(l.a)({},e),{},{currentCell:t.payload.cells,points:e.points+(i?0:10),visitedCells:new Set([].concat(Object(c.a)(e.visitedCells),[t.payload.cells.toString()]))});default:throw new Error("Unknown action")}}var $=new Audio(J.a);$.loop=!0,$.volume=.3;var F=new Audio(q.a);var K=function(){var e=Object(r.useReducer)(X,{points:0,round:1,hiScore:0,time:void 0,maze:void 0,currentCell:void 0,visitedCells:new Set,isGoalReached:!1,prizes:[]}),t=Object(s.a)(e,2),n=t[0],i=t[1],o=!n.time,c=Object(r.useCallback)((function(){n.time||i({type:"startGame",payload:{maze:new I(17,33,T.length).generate()}})}),[n.time]),l=Object(r.useCallback)((function(e){if(n.currentCell&&n.maze&&!o&&!n.isGoalReached){var t=n.maze.validateStep(n.currentCell,e.key),r=t.isValid,a=t.newPos;if(r){var s=n.prizes.findIndex((function(e){return O(e.cell,a)}));s>=0?i({type:"reachPrize",payload:{removeIndex:s}}):n.maze.isGoalReached(a)&&i({type:"reachGoal"}),i({type:"moveCharacter",payload:{cells:a}})}}}),[n.currentCell,n.maze,o,n.isGoalReached,n.prizes]);return U([E],c),U([S,x,R,G],l),Object(h.a)((function(){i({type:"decrementTime"})}),n.time&&!n.isGoalReached?1e3:null),Object(r.useEffect)((function(){0===n.time?($.pause(),$.currentTime=0,i({type:"endGame"})):60-n.time===2?i({type:"addPrize",payload:{index:0}}):15===n.time&&i({type:"addPrize",payload:{index:1}})}),[n.time]),Object(r.useEffect)((function(){n.round>0&&n.time>0&&!n.isGoalReached&&$.play()}),[n.round,n.time,n.isGoalReached]),Object(r.useEffect)((function(){var e=function(){F.currentTime=0,i({type:"winGame",payload:{maze:new I(17,33,T.length).generate()}})};return n.isGoalReached&&($.pause(),$.currentTime=0,F.play(),F.addEventListener("ended",e)),function(){return F.removeEventListener("ended",e)}}),[n.isGoalReached]),a.a.createElement("div",{className:d.a.root},a.a.createElement(p,{hiScore:n.hiScore,points:n.points,time:n.time,round:n.round}),a.a.createElement(D,{maze:n.maze,currentCell:n.currentCell,prizes:n.prizes}),a.a.createElement(b,{show:!n.time,gameOver:0===n.time}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(K,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}],[[20,1,2]]]);
//# sourceMappingURL=main.0bfc5651.chunk.js.map